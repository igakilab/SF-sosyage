<html lang="ja">
<head>
<title>戦闘画面</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<style>
.gauge_wrap li>div {
	background: -moz-linear-gradient(top, #555, #222);
	background: -webkit-gradient(linear, left top, left bottom, from(#555),
		to(#222));
	border: solid 5px #000;
	width: 300px;
	/* height: 32px;*/
}

.gauge_wrap .gauge_main {
	background: -moz-linear-gradient(top, #9FF, #0FF);
	background: -webkit-gradient(linear, left top, left bottom, from(#9FF),
		to(#0FF));
	height: 22px;
}
.gauge_wrap .gauge_main2 {
	background: -moz-linear-gradient(top, #9FF, #0FF);
	background: -webkit-gradient(linear, left top, left bottom, from(#ADFF2F),
		to(#7FFF00));
	height: 22px;
}
</style>
<script type="text/javascript" src="dwr/engine.js"></script>
<script type="text/javascript" src="dwr/util.js"></script>
<script type="text/javascript" src="js/jquery-2.1.4.min.js"></script>
<script type="text/javascript" src="js/jquery.serialize.js"></script>
<script type="text/javascript" src="dwr/interface/BattleSystem.js"></script>
<script type="text/javascript" src="js/jquery.cookie.js"></script>
<script type="text/javascript" src="dwr/interface/TeamPrinter.js"></script>
<script type="text/javascript">

	var userID = $.cookie("userID");
	var akt1 = $.cookie("akt1");
	var akt2 = $.cookie("akt2");
	var akt3 = $.cookie("akt3");



	//userID,これはパスワードなどで判別できるようにする
	var turncount = 0;
	//turnの変数
	var enemyHP;
	//敵の体力
	var enemyAT;
	//敵の攻撃力
	var mysumHP;
	//自分のパーティーの体力
	var mysumAT;
	//自分のパーティーの攻撃力
	var a;
	//敵の現体力
	var b;
	//自分のパーティーの現体力
	//敵のIDを格納

	BattleSystem.getturn(userID, {
		callback : function(turndata) {
			turncount = parseInt(turndata[0]);
		}
	});

	BattleSystem.geteneID(userID,{
		callback : function(data){
			BattleSystem.getenemy(data, {
				//1とはステージを表している
				callback : function(enedata) {
					enemyHP = parseInt(enedata[0]);
					enemyAT = parseInt(enedata[1]);
					a = enemyHP;
					$("#enemyimg").attr("src", "img/enemy/" + enedata[2]);
				}
			});
		}
	});

	var user = {
		userID : userID,
		userspot1 : 0,
		userspot2 : 0
	};
	TeamPrinter.fetchslot(user, {
		callback : function(partyimg) {
			$("#partymember1").attr("src",
					"img/character/img_" + partyimg[0] + ".png");
			$("#partymember2").attr("src",
					"img/character/img_" + partyimg[1] + ".png");
			$("#partymember3").attr("src",
					"img/character/img_" + partyimg[2] + ".png");
		}
	});

	BattleSystem.getatkhp(userID, {
		callback : function(data) {
			mysumAT = parseInt(data[0]);
			mysumHP = parseInt(data[1]);
			b = mysumHP;

			(function() {
				turnup();

				aktchange1();
				aktchange3();
				aktchange5();

			})();

		}
	});

	function turnup() {
		$('#turn').text(turncount.toString());
		if (turncount != 0) {
			a -= mysumAT;
			$('#log').val($('#log').val() + mysumAT + "のダメージを与えた\n");

			if(a<=0){
				$('#EHP').text(a.toString() + "/" + enemyHP.toString());
				$('.gauge_main').css('width', (100 * a / enemyHP) + '%');
				$.cookie("turn",turncount);

				alert('倒した!');
				window.location.replace('result.html');
				return ;
				}
			b -= enemyAT;
			$('#log').val($('#log').val() + enemyAT + "のダメージを受けた\n");

		}

		turncount++;

		$('#EHP').text(a.toString() + "/" + enemyHP.toString());
		$('.gauge_main').css('width', (100 * a / enemyHP) + '%');
		$('#MHP').text(b.toString() + "/" + mysumHP.toString());
		$('.gauge_main2').css('width', (100 * b / mysumHP) + '%');

	}

	function aktchange1(){
		akt1 = 1;
		$.cookie("akt1",akt1);
		colorchange();
	}
	function aktchange2(){
		akt1 = 2;
		$.cookie("akt1",akt1);
		colorchange();
	}
	function aktchange3(){
		akt2 = 1;
		$.cookie("akt2",akt2);
		colorchange();
	}
	function aktchange4(){
		akt2 = 2;
		$.cookie("akt2",akt2);
		colorchange();
	}
	function aktchange5(){
		akt3 = 1;
		$.cookie("akt3",akt3);
		colorchange();
	}
	function aktchange6(){
		akt3 = 2;
		$.cookie("akt3",akt3);
		colorchange();
	}
function colorchange(){
	if(akt1==1){
		$("#botton1").css("color","#ff0000");
		$("#botton2").css("color","#000000");
	}else{
		$("#botton2").css("color","#ff0000");
		$("#botton1").css("color","#000000");
	}
	if(akt2==1){
		$("#botton3").css("color","#ff0000");
		$("#botton4").css("color","#000000");
	}else{
		$("#botton4").css("color","#ff0000");
		$("#botton3").css("color","#000000");
	}
	if(akt3==1){
		$("#botton5").css("color","#ff0000");
		$("#botton6").css("color","#000000");
	}else{
		$("#botton6").css("color","#ff0000");
		$("#botton5").css("color","#000000");
	}


}


	function attack(){
		var battledata = {userID:userID,c1:akt1,c2:akt2,c3:akt3,ene:1}
		  BattleSystem.battle(battledata,{
	          callback: function(data) {
	        	  mysumAT = data[0];

	        		(function() {
	    				turnup();
	    			})();
	          },

	  		});
	}

</script>
</head>
<body>

	<ul class="gauge_wrap" style="list-style-type: none">
		<li>
			<div>
				<div class="gauge_main" style="width: 80%;"></div>
			</div>
		</li>
	</ul>


	turn
	<span id="turn"></span> enemyHP
	<span id="EHP"></span>
	<img id="enemyimg" src="">
	<textarea id="log" name="log" cols="50" rows="10" readonly></textarea>
	<br>
	<input value="たたかう" type="button" onclick="attack()" />
	<br>
	<img id="partymember1" src="" width="160">
	<img id="partymember2" src="" width="160">
	<img id="partymember3" src="" width="160">
	<br>
	<input id="botton1" value="攻撃" type="button" onclick="aktchange1()" />
	<input id="botton2" value="必殺" type="button" onclick="aktchange2()" />
	<input id="botton3" value="攻撃" type="button" onclick="aktchange3()" />
	<input id="botton4" value="必殺" type="button" onclick="aktchange4()" />
	<input id="botton5" value="攻撃" type="button" onclick="aktchange5()" />
	<input id="botton6" value="必殺" type="button" onclick="aktchange6()" />
	<br>
	<ul class="gauge_wrap" style="list-style-type: none">
		<li>
			<div>
				<div class="gauge_main2" style=" width: 80%;"></div>
			</div>
		</li>
	</ul>
	<br> mysumHP
	<span id="MHP"></span>



	<script type="text/javascript">

	</script>

</body>
</html>






























