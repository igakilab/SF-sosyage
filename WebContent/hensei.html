<html lang="ja">
  <head>
  <title>編成</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <style>
  .border1 {
  	border: double 10px #0000ff;
  }
  </style>

    <script type="text/javascript" src="dwr/engine.js"></script>
    <script type="text/javascript" src="dwr/util.js"></script>
    <script type="text/javascript" src="js/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="js/jquery.serialize.js"></script>
    <script type="text/javascript" src="js/jquery.cookie.js"></script>
    <script type="text/javascript" src="dwr/interface/TeamPrinter.js"></script>
    <script type="text/javascript">
    var kjid = 0;
    var userID = $.cookie("userID");
    function Click(number){
    	if(kjid == 0){
    	//1回目のキャラクタークリック//
    	 kjid =number;
  		 $("#"+kjid).attr('class', "border1");
    	 return;
    	}else if(number!=kjid){
    		var s1=1;
			var s2=2;
    		//2回目のキャラクタークリック//
    		var iskslot=(kjid==slotdata[0]||kjid==slotdata[1]||kjid==slotdata[2]);
    		var isnslot=(number==slotdata[0]||number==slotdata[1]||number==slotdata[2]);
    		if (!iskslot && !isnslot) {
        		$("#"+kjid).attr('class', "");
        		kjid=0;
    			return;
    		}
    		if(iskslot){
    			if(isnslot){
    				//クリック判定、1回目がスロットで2回目がスロットのパターン//
    				for(i=1;i<=3;++i){
    					if(slotdata[i-1]==kjid){
    						s1=i;
    					}else if(slotdata[i-1]==number){
    						s2=i;
    					}
    				}
    	    		var user2 = {userID:userID,userspot1:s1,userspot2:s2};
        				TeamPrinter.changeslot(user2,{
        			 		callback: function() {
        		        		fetchslot();
        		        		characterfetch();
        		        	}
        		      });
    			}else{
    				for(i=1;i<=3;++i){
    					if(slotdata[i-1]==kjid){
    						s1=i;
    					}
    				}
    	    		var user2 = {userID:userID,userspot1:s1,userspot2:number};
    				TeamPrinter.changeslot2(user2,{
    			 		callback: function() {
    		        		fetchslot();
    		        		characterfetch();
    		        	}
    		      });
    			}
    		}else if(isnslot){
    			for(i=1;i<=3;++i){
					if(slotdata[i-1]==number){
						s1=i;
					}
    			}
	    		var user2 = {userID:userID,userspot1:s1,userspot2:kjid};
				TeamPrinter.changeslot2(user2,{
			 		callback: function() {
		        		fetchslot();
		        		characterfetch();
		        	}
		      });
    		}
    		$("#"+kjid).attr('class', "border1");
    		kjid=0;
    	}
      }
    </script>

  </head>
  <body>
	<p>
    <br></br>
    </p>
    <p>
    <div id = "textbox">
    </div>
    <br></br>
    <div id = "charabox">
    </div>
    <script type="text/javascript">
    var userID = $.cookie("userID");
    var user = {userID:userID,userspot1:0,userspot2:0};
    var slotdata;
    function fetchslot(){
    TeamPrinter.fetchslot(user, {
        callback: function(data) {
			if($('#textbox').length){
				$("#textbox").empty();
			}
        	slotdata=data;
        	for(var i = 0;i<data.length;++i){
				$("#textbox").html($("#textbox").html()+'<img src="" width="120" id ='+data[i]+' onclick="Click('+data[i]+')">');
				$('#' + data[i]).attr('src', 'img/character/img_'+data[i]+'.png');
				}
        	}
      	}
    );}
    function characterfetch (){
    TeamPrinter.characterfetch(user,{
		callback:function(data2){
			if($('#charabox').length){
				$("#charabox").empty();
			}
			for(var i = 1;i<=data2.length;++i){
				var id=i;
				if(data2[i]>0&&i!=slotdata[0]&&i!=slotdata[1]&&i!=slotdata[2]){
				$("#charabox").html($("#charabox").html()+'<img src="" width="120" id ='+id+' onclick="Click('+id+')">');
				$('#' + id).attr('src', 'img/character/img_'+i+'.png');
					}
				}
			}
		}
    );}
    fetchslot();
    characterfetch();
    </script>
  </body>
</html>
